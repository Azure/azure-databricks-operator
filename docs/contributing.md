# Prerequisites And Assumptions

1. You have the kubectl command line (kubectl CLI) installed.

2. You have acess to a Kubernetes cluster. It can be a local hosted Cluster like [Minikube](https://kubernetes.io/docs/tasks/tools/install-minikube/), [Kind](https://github.com/kubernetes-sigs/kind) or, Docker for desktop installed localy with RBAC enabled. if you opt for Azure Kubernetes Service ([AKS](https://azure.microsoft.com/en-au/services/kubernetes-service/)), you can use: `az aks get-credentials --resource-group $RG_NAME --name $Cluster_NAME`

* To configure a local Kubernetes cluster on your machine
    > You need to make sure a kubeconfig file is configured.

Basic commands to check your cluster

```shell
    kubectl config get-contexts
    kubectl cluster-info
    kubectl version
    kubectl get pods -n kube-system
```

![alt text](docs/images/development-flow.jpg "development flow")

# Run Souce Code

1. Clone the repo  - make sure your go path points to `microsoft\azure-databricks-operator`

2. Install the NotebookJob CRD in the configured Kubernetes cluster folder ~/.kube/config,
run `kubectl apply -f databricks-operator/config/crds` or `make install -C databricks-operator`

3. Set the Environment variables for `DATABRICKS_HOST` and `DATABRICKS_TOKEN`

    Windows command line:
    ```shell
    set DATABRICKS_TOKEN=xxxx
    set DATABRICKS_HOST=https://xxxx.azuredatabricks.net
    ```

    bash:
    ```shell
    export DATABRICKS_TOKEN=xxxx
    export DATABRICKS_HOST=https://xxxx.azuredatabricks.net
    ```

    Make sure your secret mapping is set correctly in `config/default/manager_image_patch.yaml`

4.Install [Kustomize] (https://github.com/kubernetes-sigs/kustomize) and deploy the controller in the configured Kubernetes cluster folder ~/.kube/config, run `kustomize build config/default | kubectl apply -f -`

5. Change the NotebookJob name from `sample1run1` to your desired name, set the Databricks notebook path and update the values in databricks_v1_notebookjob.yaml` to reflect your Databricks environment

    ```shell
    kubectl apply -f databricks-operator/config/samples/databricks_v1_notebookjob.yaml
    ```

# How to extend the operator and build your own images

## Updating the Databricks operator:

This Repo is generated by [Kubebuilder](https://book.kubebuilder.io/), version:`2.0.0-alpha.4`.

To Extend the operator `databricks-operator`:

1. Run `go mod tidy` to download dependencies. It doesn't show any progress bar and takes a while to download all of dependencies.
2. Update `api\v1\notebookjob_types.go`.
3. Regenerate CRD `make manifests`.
4. Install updated CRD `make install`
5. Generate code `make generate`
6. Update operator `controllers\notebookjob_controller.go`
7. Update tests and run `make test`
8. Build `make build`
9. Deploy

    ```shell
    make docker-build IMG={your-docker-image-name}
    make docker-push IMG={your-docker-image-name}
    make deploy
    ```

# Main Contributors

1. Jordan Knight [Github](https://github.com/jakkaj), [Linkedin](https://www.linkedin.com/in/jakkaj/)
2. Paul Bouwer [Github](https://github.com/paulbouwer), [Linkedin](https://www.linkedin.com/in/pbouwer/)
3. Lace Lofranco [Github](https://github.com/devlace), [Linkedin](https://www.linkedin.com/in/lacelofranco/)
4. Allan Targino [Github](https://github.com/allantargino), [Linkedin](https://www.linkedin.com/in/allan-targino//)
5. Xinyun (Jacob) Zhou [Github](https://github.com/xinsnake), [Linkedin](https://www.linkedin.com/in/xinyun-zhou/)
6. Jason Goodsell [Github](https://github.com/JasonTheDeveloper), [Linkedin](https://www.linkedin.com/in/jason-goodsell-2505a3b2/)
7. Craig Rodger [Github](https://github.com/crrodger), [Linkedin](https://www.linkedin.com/in/craigrodger/)
8. Justin Chizer [Github](https://github.com/justinchizer), [Linkedin](https://www.linkedin.com/in/jchizer/)
9. Priya Kumaran [Github](https://github.com/priyakumarank), [Linkedin](https://www.linkedin.com/in/priyakumaran/)
10. Azadeh Khojandi [Github](https://github.com/Azadehkhojandi), [Linkedin](https://www.linkedin.com/in/azadeh-khojandi-ba441b3/)